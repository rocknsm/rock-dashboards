output {

  # Requires event module and category
  if [event][module] and [event][category] {
    kafka {
      codec => json
      topic_id => "ecs-%{[event][module]}-%{[event][category]}"
      bootstrap_servers => "127.0.0.1:9092"
    }

    # Requires event dataset
    if [event][dataset] {
      elasticsearch {
          hosts => ["127.0.0.1"]
          index => "ecs-%{[event][module]}-%{[event][category]}-%{[event][dataset]}-%{+YYYY.MM.dd}"
          manage_template => false
      }
    }

    else {
      # Suricata or Bro JSON error possibly, ie: Suricata without a event.dataset seen with filebeat error, but doesn't ahve a tag
      if [event][module] == "suricata" or [event][module] == "zeek" {
        elasticsearch {
            hosts => ["127.0.0.1"]
            index => "parse-failures-%{+YYYY.MM.dd}"
            manage_template => false
        }
      }
      else {
        elasticsearch {
            hosts => ["127.0.0.1"]
            index => "ecs-%{[event][module]}-%{[event][category]}-%{+YYYY.MM.dd}"
            manage_template => false
        }
      }
    }
  }

  # Catch all index that is not ECS or other
  else {
    elasticsearch {
        hosts => ["127.0.0.1"]
        index => "indexme-%{+YYYY.MM.dd}"
        manage_template => false
    }
  }

  #TODO:Parse Failure Index
}
