## DNS ###################################################################
filter {
  if [event][dataset] == "dns" {
    if [dns] {

      mutate {
        rename => {
          "[dns][answers]" => "[dns][answers][name]"
          "[dns][query]" => "[dns][question][name]"
          "[dns][AA]" => "[dns][flags][authoritative]"
          "[dns][TC]" => "[dns][flags][truncated_response]"
          "[dns][RD]" => "[dns][flags][recursion_desired]"
          "[dns][RA]" => "[dns][flags][recursion_available]"
          "[dns][Z]" => "[dns][flags][z_bit]"
          "[dns][rejected]" => "[dns][flags][rejected]"
          "[dns][TTLs]" => "[dns][answers][ttl]"
          "[dns][qclass_name]" => "[dns][op][class]"
          "[dns][qclass]" => "[dns][op][class_code]"
          "[dns][qtype_name]" => "[dns][question][type]"
          "[dns][qtype]" => "[dns][question][type_code]"
          "[dns][rcode_name]" => "[dns][response_code]"
          "[dns][rcode]" => "[dns][status_code]"
          "[dns][trans_id]" => "[dns][transaction_id]"
          "[dns][rtt]" => "[dns][round_trip_time]"
          "[dns][addl]" => "[dns][additionals][name]"
          "[dns][auth]" => "[dns][additionals][authoritative][name]"
        }
        copy => {
          "[dns][round_trip_time]" => "[event][duration]"
          "[dns][question][name]" => "[@metadata][destination_domain]"
        }
        merge => { "[related][domain]" => "[dns][question][name]" }
      }

      # Event outcome
      if [dns][flags][rejected] {
        translate {
          field => "[dns][flags][rejected]"
          exact => true
          dictionary => [
            "false", "success",
            "true", "failure"
          ]
          destination => "[event][outcome]"
        }
      }

    }
  }
}