filter {
  if [@metadata][stage] == 'bro_tagged_json' {

    if [event][category] in ["known_certs", "known_devices", "known_hosts", "known_modbus", "known_services", "software"]{
      if [@metadata][ENABLE_BRO_OBSERVATIONS] == false {
        # Configuration has disabled bro observation events
        drop { }
      }

      mutate {
        add_field => {
          "[event][module]" => "observations"
          "[@metadata][stage]" => "bro_observations"
        }
      } # mutate
    }
  }
}
